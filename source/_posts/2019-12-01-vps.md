---
title: VPS上使用docker部署服务
categories: VPS
tags: [VPS, VPN, IPSec, NAT, Docker]
date: 2019-12-01
---

## 重新部署

之前用直接安装的方法在VPS上部署了frps、vpn，感觉这种方法不够优雅（偷懒），时间一长，想要修改用户名密码或升级版本，也不方便维护。后来想起来，能不能把这些服务部署到docker上呢，然后就在dockerhub上搜索和测试，确认可行，感觉终于找到了最佳体验。

## 在VPS上安装docker

安装命令见百度

```bash
sudo docker info
```

## docker部署frp

### 在具有公网IP的VPS上部署frps

```bash
docker run \
--name frp-server \
--restart=always \
-p <HOST_PORT>:<CONTAINER_PORT> \
-v <ABSOLUTE_PATH>/conf:/conf \
-d \
cloverzrg/frps-docker:0.29.1
```

注意：

- cloverzrg/frps-docker的frps程序已指定使用容器下的/conf/frps.ini文件作为运行配置文件，使用该镜像就需要将宿主机上的frps.ini配置文件或其所在路径相应映射到容器中
- frps相关端口需要做映射，或者偷懒将network设置为host

### 在需要内网穿透的内网主机上部署frpc

```bash
docker run \
--name frp-client \
--restart=always \
--network host \
-v <ABSOLUTE_FILENAME>:/conf/frpc.ini \
-d \
cloverzrg/frpc-docker:0.29.1
```

注意：

- 要将主机上的frpc.ini文件映射到容器中
- 必须将network设置为host
- frpc的版本需要与frps匹配

## docker部署IPSec

```bash
docker run \
--name ipsec-vpn-server \
--restart=always \
--privileged \
-p 500:500/udp \
-p 4500:4500/udp \
-e VPN_IPSEC_PSK=换成指定psk \
-e VPN_USER=换成用户名 \
-e VPN_PASSWORD=换成密码 \
-d \
hwdsl2/ipsec-vpn-server
```

注意：

- 要配置PSK、用户名和密码三个变量
- PSK及用户密码尽量复杂，包含数字、大小写英文和半角标点字符，不少于16位

## docker部署shadowsocks-libev

由于win10连接ipsec或pptp服务总无法成功，按照网上各种方法也尝试过，终究没有成功。为了win10工作机能科学上网，最后终于发现shadowsocks，docker部署方法相同

```bash
docker run \
-e PASSWORD=<password> \
-p <server-port>:8388 \
-p <server-port>:8388/udp \
-d \
shadowsocks/shadowsocks-libev
```

注意：

- 映射到8388的tcp和udp的端口号也应该一致
- PASSWORD也应该尽量复杂，包含数字、大小写英文和半角标点字符，不少于16位
- win10或mac系统上安装相应版本的[shadowsocks客户端](https://github.com/shadowsocks/shadowsocks-windows/releases)，配置好服务器地址端口密码等参数后即可使用

## 假装做个总结

双十一买了个小米电磁炉和平底锅，买前看了好几个测评，有说噪声大的，实际使用后，感觉噪声一般，没有以前用的美的电磁炉的噪声大。冰箱里还有以前包的饺子，开燃气灶烧的时候只会蒸着吃煮着吃的技能，看到米家app上还有用电磁炉做煎饺的菜谱。饺子解了冻，平底锅里加了油，热一会儿后，放上饺子，盖上锅盖，最后惊喜发现，电磁炉煎好饺子后貌似会自动关闭，以后烧菜都可以不用守着了？！后来煮玉米和煮鸡蛋也会自动关闭，确认👌。待尝试传说中的低温慢煮牛排🐂。
